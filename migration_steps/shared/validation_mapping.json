{
    "bonds": {
        "exclude": [
            "order_id"
        ],
        "casenumber_source": "client_persons.caserecnumber",
        "orderby": {
            "casesubtype": {
                "mapping_table": "cases.casesubtype",
                "direction": "ASC"
            },
            "orderdate": {
                "mapping_table": "cases.orderdate",
                "direction": "ASC"
            }
        },
        "casrec": {
            "from_table": "order",
            "transform": {},
            "joins": [
                "LEFT JOIN casrec_csv.pat ON casrec_csv.pat.\"Case\" = casrec_csv.order.\"Case\""
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_bonds exc_table ON exc_table.caserecnumber = pat.\"Case\"\n",
            "where_clauses": [
                "casrec_csv.order.\"Bond No.\" != ''"
            ]
        },
        "sirius": {
            "from_table": "bonds",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.cases ON cases.id = bonds.order_id",
                "LEFT JOIN {target_schema}.persons ON persons.id = cases.client_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_bonds exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": [
                "persons.clientsource = 'CASRECMIGRATION'"
            ]
        }
    },
    "cases": {
        "exclude": [
            "assignee_id",
            "caserecnumber",
            "client_id",
            "correspondent_id",
            "donor_id",
            "feepayer_id",
            "person_id",
            "uid"
        ],
        "casenumber_source": "client_persons.caserecnumber",
        "orderby": {
            "casesubtype": {
                "mapping_table": "cases.casesubtype",
                "direction": "ASC"
            },
            "orderdate": {
                "mapping_table": "cases.orderdate",
                "direction": "ASC"
            }
        },
        "casrec": {
            "from_table": "order",
            "transform": {},
            "joins": [
                "LEFT JOIN casrec_csv.pat ON casrec_csv.pat.\"Case\" = casrec_csv.order.\"Case\""
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_cases exc_table ON exc_table.caserecnumber = pat.\"Case\"",
            "where_clauses": []
        },
        "sirius": {
            "from_table": "cases",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.persons ON persons.id = cases.client_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_cases exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": [
                "persons.type = 'actor_client'",
                "persons.clientsource = 'CASRECMIGRATION'",
                "cases.casetype = 'ORDER'"
            ]
        }
    },
    "client_addresses": {
        "exclude": [
            "person_id",
            "address_lines"
        ],
        "casenumber_source": "client_persons.caserecnumber",
        "orderby": {},
        "casrec": {
            "from_table": "pat",
            "transform": {
                "address_lines": "CONCAT(\"Adrs1\", ',', \"Adrs2\")"
            },
            "joins": [],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_addresses exc_table ON exc_table.caserecnumber = pat.\"Case\"",
            "where_clauses": []
        },
        "sirius": {
            "from_table": "addresses",
            "transform": {
                "address_lines": "array_to_string(ARRAY(SELECT json_array_elements_text(addresses.address_lines)), ',')"
            },
            "joins": [
                "LEFT JOIN {target_schema}.persons ON persons.id = addresses.person_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_addresses exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": [
                "persons.type = 'actor_client'",
                "persons.clientsource = 'CASRECMIGRATION'"
            ]
        }
    },
    "client_death_notifications": {
        "exclude": [
            "person_id"
        ],
        "casenumber_source": "client_persons.caserecnumber",
        "orderby": {},
        "casrec": {
            "from_table": "pat",
            "transform": {},
            "joins": [],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_death_notifications exc_table ON exc_table.caserecnumber = pat.\"Case\"",
            "where_clauses": [
                "casrec_csv.pat.\"Term Type\" = 'D'"
            ]
        },
        "sirius": {
            "from_table": "death_notifications",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.persons ON persons.id = death_notifications.person_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_death_notifications exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": [
                "persons.type = 'actor_client'",
                "persons.clientsource = 'CASRECMIGRATION'"
            ]
        }
    },
    "client_nodebtchase_warnings": {
        "exclude": [],
        "casenumber_source": "client_persons.caserecnumber",
        "orderby": {},
        "casrec": {
            "from_table": "pat",
            "transform": {},
            "joins": [],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_nodebtchase_warnings exc_table ON exc_table.caserecnumber = pat.\"Case\"",
            "where_clauses": [
                "casrec_csv.pat.\"Debt chase\" != ''"
            ]
        },
        "sirius": {
            "from_table": "person_warning",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.persons ON persons.id = person_warning.person_id",
                "LEFT JOIN {target_schema}.warnings ON warnings.id = person_warning.warning_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_nodebtchase_warnings exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": [
                "persons.type = 'actor_client'",
                "persons.clientsource = 'CASRECMIGRATION'",
                "warnings.warningtype = 'OTHER'",
                "warnings.warningtext = 'No Debt to be chased'"
            ]
        }
    },
    "client_persons": {
        "exclude": [
            "caserecnumber",
            "dateofdeath",
            "middlenames",
            "uid"
        ],
        "casenumber_source": "client_persons.caserecnumber",
        "orderby": {},
        "casrec": {
            "from_table": "pat",
            "transform": {},
            "joins": [],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_persons exc_table ON exc_table.caserecnumber = pat.\"Case\"",
            "where_clauses": []
        },
        "sirius": {
            "from_table": "persons",
            "transform": {},
            "joins": [],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_persons exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": [
                "persons.type = 'actor_client'",
                "persons.clientsource = 'CASRECMIGRATION'"
            ]
        }
    },
    "client_phonenumbers": {
        "exclude": [
            "person_id"
        ],
        "casenumber_source": "client_persons.caserecnumber",
        "orderby": {},
        "casrec": {
            "from_table": "pat",
            "transform": {},
            "joins": [],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_phonenumbers exc_table ON exc_table.caserecnumber = pat.\"Case\"",
            "where_clauses": []
        },
        "sirius": {
            "from_table": "phonenumbers",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.persons ON persons.id = phonenumbers.person_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_phonenumbers exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": [
                "persons.type = 'actor_client'",
                "persons.clientsource = 'CASRECMIGRATION'"
            ]
        }
    },
    "client_saarcheck_warnings": {
        "exclude": [],
        "casenumber_source": "client_persons.caserecnumber",
        "orderby": {},
        "casrec": {
            "from_table": "pat",
            "transform": {},
            "joins": [],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_saarcheck_warnings exc_table ON exc_table.caserecnumber = pat.\"Case\"",
            "where_clauses": [
                "casrec_csv.pat.\"SAAR Check\" != ''"
            ]
        },
        "sirius": {
            "from_table": "person_warning",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.persons ON persons.id = person_warning.person_id",
                "LEFT JOIN {target_schema}.warnings ON warnings.id = person_warning.warning_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_saarcheck_warnings exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": [
                "persons.type = 'actor_client'",
                "persons.clientsource = 'CASRECMIGRATION'",
                "warnings.warningtype = 'OTHER'",
                "warnings.warningtext = 'SAAR CHECK DONE'"
            ]
        }
    },
    "client_special_warnings": {
        "exclude": [],
        "casenumber_source": "client_persons.caserecnumber",
        "orderby": {},
        "casrec": {
            "from_table": "pat",
            "transform": {},
            "joins": [],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_special_warnings exc_table ON exc_table.caserecnumber = pat.\"Case\"",
            "where_clauses": [
                "casrec_csv.pat.\"SIM\" != ''"
            ]
        },
        "sirius": {
            "from_table": "person_warning",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.persons ON persons.id = person_warning.person_id",
                "LEFT JOIN {target_schema}.warnings ON warnings.id = person_warning.warning_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_special_warnings exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": [
                "persons.type = 'actor_client'",
                "persons.clientsource = 'CASRECMIGRATION'",
                "warnings.warningtype = 'OTHER'",
                "warnings.warningtext = 'Special Interest'"
            ]
        }
    },
    "client_violent_warnings": {
        "exclude": [],
        "casenumber_source": "client_persons.caserecnumber",
        "orderby": {},
        "casrec": {
            "from_table": "pat",
            "transform": {},
            "joins": [],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_violent_warnings exc_table ON exc_table.caserecnumber = pat.\"Case\"",
            "where_clauses": [
                "casrec_csv.pat.\"VWM\" != ''",
                "casrec_csv.warning_violent_lookup(casrec_csv.pat.\"VWM\") = 'Marker'",
                "casrec_csv.warning_violent_lookup(casrec_csv.pat.\"VWM\") = 'Marker'"
            ]
        },
        "sirius": {
            "from_table": "person_warning",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.persons ON persons.id = person_warning.person_id",
                "LEFT JOIN {target_schema}.warnings ON warnings.id = person_warning.warning_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_client_violent_warnings exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": [
                "persons.type = 'actor_client'",
                "persons.clientsource = 'CASRECMIGRATION'",
                "warnings.warningtype = 'Marker'",
                "warnings.warningtext = 'Marker'"
            ]
        }
    },
    "deputy_death_notifications": {
        "exclude": [
            "person_id"
        ],
        "casenumber_source": "cases.caserecnumber",
        "orderby": {
            "casesubtype": {
                "mapping_table": "cases.casesubtype",
                "direction": "ASC"
            },
            "orderdate": {
                "mapping_table": "cases.orderdate",
                "direction": "ASC"
            },
            "email": {
                "mapping_table": "deputy_persons.email",
                "direction": "ASC"
            }
        },
        "casrec": {
            "from_table": "deputy",
            "transform": {},
            "joins": [
                "LEFT JOIN casrec_csv.deputyship ON casrec_csv.deputyship.\"Deputy No\" = casrec_csv.deputy.\"Deputy No\"",
                "LEFT JOIN casrec_csv.order ON casrec_csv.order.\"Order No\" = casrec_csv.deputyship.\"Order No\""
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_deputy_death_notifications exc_table\n    ON exc_table.caserecnumber = deputyship.\"Case\"\n    AND exc_table.casesubtype = casrec_csv.order_type_lookup(casrec_csv.order.\"Ord Type\")\n    AND exc_table.orderdate = casrec_csv.order.\"Made Date\"",
            "where_clauses": [
                "casrec_csv.deputy.\"Stat\" = '99'"
            ]
        },
        "sirius": {
            "from_table": "death_notifications",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.persons ON persons.id = death_notifications.person_id",
                "LEFT JOIN {target_schema}.order_deputy ON order_deputy.deputy_id = death_notifications.person_id",
                "LEFT JOIN {target_schema}.cases ON cases.id = order_deputy.order_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_deputy_death_notifications exc_table ON exc_table.caserecnumber = cases.caserecnumber",
            "where_clauses": [
                "persons.type = 'actor_deputy'",
                "persons.clientsource = 'CASRECMIGRATION'"
            ]
        }
    },
    "deputy_persons": {
        "exclude": [
            "caserecnumber",
            "dateofdeath",
            "middlenames",
            "uid"
        ],
        "casenumber_source": "cases.caserecnumber",
        "orderby": {
            "casesubtype": {
                "mapping_table": "cases.casesubtype",
                "direction": "ASC"
            },
            "orderdate": {
                "mapping_table": "cases.orderdate",
                "direction": "ASC"
            }
        },
        "casrec": {
            "from_table": "deputyship",
            "transform": {},
            "joins": [
                "LEFT JOIN casrec_csv.order ON casrec_csv.order.\"Order No\" = casrec_csv.deputyship.\"Order No\"",
                "LEFT JOIN casrec_csv.deputy ON casrec_csv.deputyship.\"Deputy No\" = casrec_csv.deputy.\"Deputy No\"",
                "LEFT JOIN casrec_csv.pat ON casrec_csv.pat.\"Case\" = casrec_csv.order.\"Case\""
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_deputy_persons exc_table\n    ON exc_table.caserecnumber = pat.\"Case\"\n    AND exc_table.casesubtype = casrec_csv.order_type_lookup(casrec_csv.order.\"Ord Type\")\n    AND exc_table.orderdate = casrec_csv.order.\"Made Date\"",
            "where_clauses": []
        },
        "sirius": {
            "from_table": "order_deputy",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.cases ON cases.id = order_deputy.order_id",
                "LEFT JOIN {target_schema}.persons ON persons.id = order_deputy.deputy_id",
                "LEFT JOIN {target_schema}.persons AS client ON client.id = cases.client_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_deputy_persons exc_table\n    ON exc_table.caserecnumber = client.caserecnumber\n    AND exc_table.casesubtype = cases.casesubtype\n    AND CAST(exc_table.orderdate AS DATE) = cases.orderdate",
            "where_clauses": [
                "persons.type = 'actor_deputy'",
                "persons.clientsource = 'CASRECMIGRATION'"
            ]
        }
    },
    "deputy_special_warnings": {
        "exclude": [],
        "casenumber_source": "cases.caserecnumber",
        "orderby": {
            "casesubtype": {
                "mapping_table": "cases.casesubtype",
                "direction": "ASC"
            },
            "orderdate": {
                "mapping_table": "cases.orderdate",
                "direction": "ASC"
            }
        },
        "casrec": {
            "from_table": "deputyship",
            "transform": {},
            "joins": [
                "LEFT JOIN casrec_csv.order ON casrec_csv.order.\"Order No\" = casrec_csv.deputyship.\"Order No\"",
                "LEFT JOIN casrec_csv.deputy ON casrec_csv.deputyship.\"Deputy No\" = casrec_csv.deputy.\"Deputy No\""
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_deputy_special_warnings exc_table ON exc_table.caserecnumber = casrec_csv.order.\"Case\"",
            "where_clauses": [
                "casrec_csv.deputy.\"SIM\" != ''"
            ]
        },
        "sirius": {
            "from_table": "order_deputy",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.cases ON cases.id = order_deputy.order_id",
                "LEFT JOIN {target_schema}.persons ON persons.id = order_deputy.deputy_id",
                "LEFT JOIN {target_schema}.person_warning ON person_warning.person_id = order_deputy.deputy_id",
                "LEFT JOIN {target_schema}.warnings ON person_warning.warning_id = warnings.id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_deputy_special_warnings exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": [
                "persons.type = 'actor_deputy'",
                "persons.clientsource = 'CASRECMIGRATION'",
                "warnings.warningtype = 'OTHER'",
                "warnings.warningtext = 'Special Interest'"
            ]
        }
    },
    "deputy_violent_warnings": {
        "exclude": [],
        "casenumber_source": "cases.caserecnumber",
        "orderby": {
            "casesubtype": {
                "mapping_table": "cases.casesubtype",
                "direction": "ASC"
            },
            "orderdate": {
                "mapping_table": "cases.orderdate",
                "direction": "ASC"
            }
        },
        "casrec": {
            "from_table": "deputyship",
            "transform": {},
            "joins": [
                "LEFT JOIN casrec_csv.order ON casrec_csv.order.\"Order No\" = casrec_csv.deputyship.\"Order No\"",
                "LEFT JOIN casrec_csv.deputy ON casrec_csv.deputyship.\"Deputy No\" = casrec_csv.deputy.\"Deputy No\""
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_deputy_violent_warnings exc_table ON exc_table.caserecnumber = casrec_csv.order.\"Case\"",
            "where_clauses": [
                "casrec_csv.warning_violent_lookup(casrec_csv.deputy.\"VWM\") = 'Marker'",
                "casrec_csv.warning_violent_lookup(casrec_csv.deputy.\"VWM\") = 'Marker'"
            ]
        },
        "sirius": {
            "from_table": "order_deputy",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.cases ON cases.id = order_deputy.order_id",
                "LEFT JOIN {target_schema}.persons ON persons.id = order_deputy.deputy_id",
                "LEFT JOIN {target_schema}.person_warning ON person_warning.person_id = order_deputy.deputy_id",
                "LEFT JOIN {target_schema}.warnings ON person_warning.warning_id = warnings.id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_deputy_violent_warnings exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": [
                "persons.type = 'actor_deputy'",
                "persons.clientsource = 'CASRECMIGRATION'",
                "warnings.warningtype = 'Marker'",
                "warnings.warningtext = 'Marker'"
            ]
        }
    },
    "notes": {
        "exclude": [
            "createdtime",
            "upload_id",
            "document_id"
        ],
        "casenumber_source": "client_persons.caserecnumber",
        "orderby": {},
        "casrec": {
            "from_table": "remarks",
            "transform": {
                "createdtime": "TO_TIMESTAMP(CONCAT(remarks.\"Logdate\", ' ', LEFT(remarks.\"Logtime\", 8)), 'YYYY-MM-DD HH24:MI:SS')"
            },
            "joins": [
                "LEFT JOIN casrec_csv.pat ON casrec_csv.pat.\"Case\" = casrec_csv.remarks.\"Case\""
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_notes exc_table ON exc_table.caserecnumber = pat.\"Case\"",
            "where_clauses": []
        },
        "sirius": {
            "from_table": "caseitem_note",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.cases ON cases.id = caseitem_note.caseitem_id",
                "LEFT JOIN {target_schema}.notes ON notes.id = caseitem_note.note_id",
                "LEFT JOIN {target_schema}.persons ON persons.id = cases.client_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_notes exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": [
                "persons.type = 'actor_client'",
                "persons.clientsource = 'CASRECMIGRATION'"
            ]
        }
    },
    "supervision_level_log": {
        "exclude": [
            "order_id"
        ],
        "casenumber_source": "client_persons.caserecnumber",
        "orderby": {},
        "casrec": {
            "from_table": "order",
            "transform": {},
            "joins": [
                "LEFT JOIN casrec_csv.pat ON casrec_csv.pat.\"Case\" = casrec_csv.order.\"Case\""
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_supervision_level_log exc_table ON exc_table.caserecnumber = pat.\"Case\"",
            "where_clauses": []
        },
        "sirius": {
            "from_table": "supervision_level_log",
            "transform": {},
            "joins": [
                "LEFT JOIN {target_schema}.cases ON cases.id = supervision_level_log.order_id",
                "LEFT JOIN {target_schema}.persons ON persons.id = cases.client_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_supervision_level_log exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": []
        }
    },
    "visits": {
        "exclude": [
            "client_id"
        ],
        "casenumber_source": "client_persons.caserecnumber",
        "orderby": {},
        "casrec": {
            "from_table": "REPVIS",
            "transform": {},
            "joins": [
                "LEFT JOIN casrec_csv.pat ON casrec_csv.pat.\"Case\" = casrec_csv.REPVIS.\"Case\""
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_visits exc_table ON exc_table.caserecnumber = REPVIS.\"Case\"",
            "where_clauses": []
        },
        "sirius": {
            "from_table": "visits",
            "transform": {
                "visitcreateddate": "to_char({col}, 'DD/MM/YY')",
                "visitreportduedate": "to_char({col}, 'DD/MM/YY')",
                "visitcompleteddate": "to_char({col}, 'DD/MM/YY')",
                "visitreportrevieweddate": "to_char({col}, 'DD/MM/YY')",
                "visitcommissiondate": "to_char({col}, 'DD/MM/YY')",
                "firstextendedvisitreportduedate": "to_char({col}, 'DD/MM/YY')",
                "secondextendedvisitreportduedate": "to_char({col}, 'DD/MM/YY')"
            },
            "joins": [
                "LEFT JOIN {target_schema}.persons ON persons.id = visits.client_id"
            ],
            "exception_table_join": "LEFT JOIN casrec_csv.exceptions_visits exc_table ON exc_table.caserecnumber = persons.caserecnumber",
            "where_clauses": []
        }
    }
}
