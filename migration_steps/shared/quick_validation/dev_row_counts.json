[
  {
    "clients": [
      {
        "table_name": "persons",
        "casrec_query": "select count(*) from casrec_csv.pat;",
        "query": "select count(*) from {schema}.persons where type='actor_client';"
      },
      {
        "table_name": "addresses",
        "casrec_query": "select count(*) from casrec_csv.pat;",
        "query": "select count(*) from {schema}.addresses where person_id in (select id from {schema}.persons where type='actor_client');"
      },
      {
        "table_name": "phonenumbers",
        "casrec_query": "select count(*) from casrec_csv.pat",
        "query": "select count(*) from {schema}.phonenumbers where person_id in (select id from {schema}.persons where type='actor_client');"
      }
    ]
  },
  {
    "deputies": [
      {
        "table_name": "persons",
        "casrec_query": "select count(*) from casrec_csv.deputy",
        "query": "select count(*) from {schema}.persons where type='actor_deputy';"
      },
      {
        "table_name": "addresses",
        "casrec_query": "select count(distinct concat(deputy.\"Deputy No\", deputy_address.\"Dep Addr No\")) from casrec_csv.deputy_address inner join casrec_csv.deputyship on deputyship.\"Dep Addr No\" = deputy_address.\"Dep Addr No\" inner join casrec_csv.deputy on deputy.\"Deputy No\" = deputyship.\"Deputy No\"",
        "query": "select count(*) from {schema}.addresses where person_id in (select id from {schema}.persons where type='actor_deputy');",
        "notes": "We end up with more in Sirius than the source table because Casrec has that extra join table that we don't so we need to duplicate some addreses"
      },
      {
        "table_name": "daytime phonenumbers",
        "casrec_query": "select count(*) from casrec_csv.deputy where (\"Contact Telephone\" != '');",
        "query": "select count(*) from {schema}.phonenumbers where type = 'Work' and person_id in (select id from {schema}.persons where type='actor_deputy');"
      },
      {
        "table_name": "evening phonenumbers",
        "casrec_query": "select count(*) from casrec_csv.deputy where (\"Contact Tele2\" != '');",
        "query": "select count(*) from {schema}.phonenumbers where type = 'Home' and person_id in (select id from {schema}.persons where type='actor_deputy');"
      },
      {
        "table_name": "order_deputy",
        "casrec_query": "select count(*) from casrec_csv.deputyship inner join casrec_csv.deputy on deputy.\"Deputy No\" =deputyship.\"Deputy No\" inner join casrec_csv.order on \"order\".\"CoP Case\" = deputyship.\"CoP Case\"",
        "query": "select count(*) from {schema}.order_deputy;"
      }
    ]
  },
  {
    "cases": [
      {
        "table_name": "cases",
        "casrec_query": "select count(*) from casrec_csv.\"order\"",
        "query": "select count(*) from {schema}.cases;"
      },
      {
        "table_name": "person_caseitem",
        "casrec_query": "select count(*) from casrec_csv.\"order\"",
        "query": "select count(*) from {schema}.person_caseitem;"
      }
    ]
  },
  {
    "remarks": [
      {
        "table_name": "supervision_notes",
        "casrec_query": "select count(*) from casrec_csv.remarks",
        "query": "select count(*) from {schema}.supervision_notes;"
      }
    ]
  },
  {
    "supervision_level": [
      {
        "table_name": "supervision_level_log",
        "casrec_query": "select count(*) from casrec_csv.\"order\"",
        "query": "select count(*) from {schema}.supervision_level_log;"
      }
    ]
  },
  {
    "bonds": [
      {
        "table_name": "bonds",
        "casrec_query": "select count(*) from casrec_csv.\"order\" where \"Bond Rqd\" = 'Y'",
        "query": "select count(*) from {schema}.bonds;"
      }
    ]
  },
  {
    "death": [
      {
        "table_name": "death_notifications (client)",
        "casrec_query": "select count(*) from casrec_csv.pat where \"Term Type\" = 'D'",
        "query": "select count(*) from {schema}.death_notifications where person_id in (select id from {schema}.persons where type='actor_client');"
      },
      {
        "table_name": "death_notifications (deputy)",
        "casrec_query": "select count(*) from casrec_csv.deputy where \"Stat\" = '99';",
        "query": "select count(*) from {schema}.death_notifications where person_id in (select id from {schema}.persons where type='actor_deputy');"
      }
    ]
  },
    {
    "warnings": [
      {
        "table_name": "client violent warnings",
        "casrec_query": "select count(*) from casrec_csv.pat where \"VWM\" not in ('', '0');",
        "query": "select count(warnings.*) from {schema}.warnings inner join {schema}.person_warning on warnings.id = person_warning.warning_id inner join {schema}.persons on person_warning.person_id = persons.id and persons.type = 'actor_client' where warningtext = 'Casrec Migration - Violent Warning';"
      },
      {
        "table_name": "deputy violent warnings",
        "casrec_query": "select count(*) from casrec_csv.deputy where \"VWM\" not in ('', '0');",
        "query": "select count(warnings.*) from {schema}.warnings inner join {schema}.person_warning on warnings.id = person_warning.warning_id inner join {schema}.persons on person_warning.person_id = persons.id and persons.type = 'actor_deputy' where warningtext = 'Casrec Migration - Violent Warning';"
      },
      {
        "table_name": "client special warnings",
        "casrec_query": "select count(*) from casrec_csv.pat where \"SIM\" not in ('', '0');",
        "query": "select count(warnings.*) from {schema}.warnings inner join {schema}.person_warning on warnings.id = person_warning.warning_id inner join {schema}.persons on person_warning.person_id = persons.id and persons.type = 'actor_client' where warningtext = 'Casrec Migration - Special Interest Warning';"
      },
      {
        "table_name": "deputy special warnings",
        "casrec_query": "select count(*) from casrec_csv.deputy where \"SIM\" not in ('', '0');",
        "query": "select count(warnings.*) from {schema}.warnings inner join {schema}.person_warning on warnings.id = person_warning.warning_id inner join {schema}.persons on person_warning.person_id = persons.id and persons.type = 'actor_deputy' where warningtext = 'Casrec Migration - Special Interest Warning';"
      },
      {
        "table_name": "client debt chase warnings",
        "casrec_query": "select count(*) from casrec_csv.pat where \"Debt chase\" not in ('', '0');",
        "query": "select count(warnings.*) from {schema}.warnings inner join {schema}.person_warning on warnings.id = person_warning.warning_id inner join {schema}.persons on person_warning.person_id = persons.id and persons.type = 'actor_client' where warningtext = 'Casrec Migration - No Debt to be chased';"
      },
      {
        "table_name": "client saar check warnings",
        "casrec_query": "select count(*) from casrec_csv.pat where \"SAAR Check\" not in ('', '0');",
        "query": "select count(warnings.*) from {schema}.warnings inner join {schema}.person_warning on warnings.id = person_warning.warning_id inner join {schema}.persons on person_warning.person_id = persons.id and persons.type = 'actor_client' where warningtext = 'Casrec Migration - SAAR Check Warning';"
      },
      {
        "table_name": "person_warning (client)",
        "casrec_query": "select (select count(*) from casrec_csv.pat where (\"VWM\" not in ('', '0')))+(select count(*) from casrec_csv.pat where (\"SIM\" not in ('', '0')))+(select count(*) from casrec_csv.pat where (\"Debt chase\" not in ('', '0')))+(select count(*) from casrec_csv.pat where (\"SAAR Check\" not in ('', '0')));",
        "query": "select count(*) from {schema}.person_warning where person_id in (select id from {schema}.persons where type='actor_client');"
      },
      {
        "table_name": "person_warning (deputy)",
        "casrec_query": "select (select count(*) from casrec_csv.deputy where (\"VWM\" not in ('', '0'))) + (select count(*) from casrec_csv.deputy where (\"SIM\" not in ('', '0')));",
        "query": "select count(*) from {schema}.person_warning where person_id in (select id from {schema}.persons where type='actor_deputy');"
      }
    ]
  },
  {
    "crec": [
      {
        "table_name": "persons_crec",
        "casrec_query": "select count(distinct \"Case\") from casrec_csv.crec",
        "query": "select count(*) from {schema}.persons where risk_score is not null;"
      }
    ]
  },
  {
    "visits": [
      {
        "table_name": "visits",
        "casrec_query": "select count(*) from casrec_csv.repvis",
        "query": "select count(*) from {schema}.visits;"
      }
    ]
  },
    {
    "reporting": [
      {
        "table_name": "annual_report_logs",
        "casrec_query": "select count(*) from casrec_csv.account",
        "query": "select count(*) from {schema}.annual_report_logs;"
      },
      {
        "table_name": "annual_report_lodging_details",
        "casrec_query": "select count(*) from casrec_csv.account",
        "query": "select count(*) from {schema}.annual_report_lodging_details;"
      }
    ]
  }
  ]


